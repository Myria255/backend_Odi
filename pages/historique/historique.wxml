<!--pages/Tour/Tour.wxml-->
<nav></nav>
<title_bar label="Historique par tour"></title_bar>
<view style="justify-content: center; align-items: center; text-align: center; margin-top: 8%; margin-bottom: 5%;">
    <block wx:if="{{result}}" wx:for="{{result}}" wx:key="id">
        <view style="margin-left: 26%; width: 276rpx; height: 88rpx; display: block; box-sizing: border-box" class="input-group">
            <view class="select-field" bindtap="openTypeTontineOptions" style="font-size: 36rpx; width: 287rpx; height: 88rpx; display: flex; box-sizing: border-box; text-align: center;">
                Tour N° <view class="select-value {{formData.tour? '' : 'placeholder'}}">
                    {{formData.tour || item.tour[0].numero_tour}}
                </view>
                <view class="select-arrow">▼</view>
            </view>
        </view>
    </block>
    <view wx:if="{{!result}}">Numéro de tour indisponible</view>
</view>
<view style="width: 750rpx; height: 323rpx; display: block; box-sizing: border-box">
    <block wx:if="{{result}}" wx:for="{{result}}" wx:key="id">
        <!--<block wx:for="{{tour}}" wx:for-item="tour" wx:key="id">-->
        <view style="position: relative; width: 345rpx; background: #fff; height: 296rpx; display: block; box-sizing: border-box; left: 12rpx; box-shadow: 0 3rpx 8rpx rgba(255,121,0,1); border-radius: 18rpx;" bind:tap="infoTontine">
            <view style="position: relative; left: 17rpx; top: 26rpx; font-size: 35rpx; font-weight: bold;">Nombre de participants ayant cotisé a ce tour:</view>

            <view style="position: relative; width: 95rpx; background: #ED6C30; height: 95rpx; left: 222rpx; top: 25rpx; display: block; box-sizing: border-box; border-radius: 99rpx">
                <text style="position: relative; left: 23rpx; top: 18rpx; font-size: 30rpx; font-weight: bolder; color: #FFFFFFFF;">{{tour.cotisation.length || item.tour[0].cotisation.length}}/{{item.nombre_participants}}</text>
            </view>
        </view>

        <view style="position: relative; width: 345rpx; background:#fff; height: 296rpx; display: block; box-sizing: border-box; left: 392rpx; top: -296rpx; font-size: 35rpx; font-weight: bold; box-shadow: 0 3rpx 8rpx rgba(255,121,0,1);border-radius: 18rpx;">
            <text style="position: relative; left: 12rpx; top: 26rpx;font-size: 35rpx; font-weight: bold;">Argent collecté
                pour ce tour:
                {{tour.montant_distribue || item.tour[0].montant_distribue}}/{{item.montant_total}} Fcfa
            </text>
        </view>
    </block>
    <block wx:if="{{!result}}">
        <view style="position: relative; width: 345rpx; background: #fff; height: 296rpx; display: block; box-sizing: border-box; left: 32rpx; box-shadow: 0 3rpx 8rpx rgba(255,121,0,1); top: 0rpx" bind:tap="infoTontine">
            <view style="position: relative; left: 16rpx; top: 25rpx; font-size: 35rpx; font-weight: bold; width: 313rpx; height: 147rpx; display: block; box-sizing: border-box">Nombre de participants ayant cotisé a ce tour:</view>

            <view style="position: relative; width: 95rpx; background: #ED6C30; height: 95rpx; left: 231rpx; top: 25rpx; display: block; box-sizing: border-box; border-radius: 99rpx">
                <text style="position: relative; left: 43rpx; top: 27rpx; font-size: 30rpx; font-weight: bolder; color: #FFFFFFFF">!</text>
            </view>
        </view>

        <view style="position: relative; width: 344rpx; background: #fff; height: 295rpx; display: block; box-sizing: border-box; left: 391rpx; top: -295rpx; font-size: 35rpx; font-weight: bold; box-shadow: 0 3rpx 8rpx rgba(255,121,0,1)">
            <text style="position: relative; left: 12rpx; top: 26rpx;font-size: 35rpx; font-weight: bold;">Argent collecté
                pour ce tour:
            </text>
            <view style="position: relative; width: 191rpx; height: 65rpx; left: 137rpx; top: 95rpx; display: block; box-sizing: border-box; font-size: large">Indisponible</view>
        </view>
    </block>
</view>

<view style="width: 712rpx; height: 375rpx; margin-left: 18rpx; display: block; box-sizing: border-box; left: 0rpx; top: 0rpx" class="conteneur contour">
    <!-- A garder c'est le chargement par défaut de la page
    <block wx:for="{{result}}" wx:key="id">
        <text style="position: relative; left: 0rpx; top: 0rpx" class="h1">Participants</text>
        <scroll-view scroll-y="true" class="scrollarea" style="width: 710rpx; height: 348rpx; display: block; box-sizing: border-box">
            <view style="position: relative; width: 710rpx; background: white; height: 74rpx; left: 0rpx; top: 23rpx; display: block; box-sizing: border-box">
                <view data-index="{{index}}" style="width: 710rpx; height: 70rpx; display: block; box-sizing: border-box">
                    <block wx:for="{{item.participant}}" wx:for-item="participant" wx:key="id_participant">
                        <block wx:for="{{participant.cotisation}}" wx:for-item="cotisation" wx:key="id_cotisation">
                            <block wx:if="{{(cotisation && cotisation.id_tour === item.tour[0].id_tour)}}">
                                <view class="listParticipant" style="width: 710rpx; height: 63rpx; display: flex; box-sizing: border-box">
                                    <view class="nom">
                                        {{participant.utilisateur.nom}} {{participant.utilisateur.prenoms}}
                                    </view>
                                    <view class="montant">{{cotisation.montant_cotise}}</view>
                                </view>
                            </block>
                        </block>
                    </block>
                </view>
            </view>
        </scroll-view>
    </block>-->

    <block wx:if="{{result}}">
        <text style="position: relative; left: 0rpx; top: 0rpx" class="h1">Cotisations réglées</text>
        <scroll-view scroll-y="true" class="scrollarea" class="scrollarea" style="width: 710rpx; height: 320rpx; display: block; box-sizing: border-box; background-color: #d9d9d960; border-radius: 18rpx;">
            <view style="position: relative; width: 710rpx; height: 74rpx; left: 0rpx; top: 23rpx; display: block; box-sizing: border-box">
                <block wx:for="{{participantsList}}" wx:key="index">
                    <view class="listParticipant" style="width: 710rpx; height: 30rpx; display: flex;">
                        <view class="nom">{{item.nom}} {{item.prenoms}}</view>
                        <view class="montant">{{item.montant}}</view>
                    </view>
                    <view class="time" style="margin-left: 10px;">{{item.date}}</view>
                </block>
            </view>
        </scroll-view>
    </block>
    <block wx:if="{{!result}}">
        <text style="position: relative; left: 0rpx; top: 0rpx" class="h1">Participants</text>
        <view style="width: 348rpx; height: 39rpx; display: flex; box-sizing: border-box; text-align: center; margin-left: 25%; margin-top: 70px">Pas de données à afficher</view>
    </block>
</view>

<view style="width: 712rpx; height: 323rpx; display: block; box-sizing: border-box; margin-left: 18rpx">
    <text style="position: relative; left: 22rpx; top: 0rpx" class="h1">Participants pénalisés</text>
    <Scroll-view scroll-y="true" class="scrollarea" style="width: 710rpx; height: 241rpx; display: block; box-sizing: border-box">
        <!-- A garder c'est le chargement par défaut de la page
        <view style="position: relative; width: 750rpx; background: white; height: 88rpx; left: 0rpx; top: 23rpx; display: block; box-sizing: border-box">
            <block wx:if="{{result}}" wx:for="{{result}}" wx:key="id">
                <view data-index="{{index}}">
                    <block wx:for="{{item.participant}}" wx:for-item="participant" wx:key="id_participant">
                        <block wx:if="{{participant.penalite && participant.penalite.length>0}}">
                            <block wx:for="{{participant.penalite}}" wx:for-item="penalite" wx:key="penalite.id_penalite">
                                <view class="listParticipant" style="width: 736rpx; height: 64rpx; display: flex; box-sizing: border-box">
                                    <view class="nom">
                                        {{participant.utilisateur.nom}} {{participant.utilisateur.prenoms}}
                                    </view>
                                    <view class="montant">
                                        {{penalite.montant_penalite}}
                                    </view>
                                </view>
                            </block>
                        </block>
                    </block>
                </view>
            </block>
        </view>-->
        <block wx:if="{{result}}">
            <view style="position: relative; width: 705rpx; background: white; height: 77rpx; left: 0rpx; top: 21rpx; display: block; box-sizing: border-box">
                <block wx:for="{{penaliteList}}" wx:key="index">
                    <view class="listParticipant" style="width: 710rpx; height: 30rpx; display: flex;">
                        <view class="nom" >{{item.nom}} {{item.prenoms}}</view>
                        <view class="montant" style="margin-left: 10%;">{{item.montant}}</view>
                    </view>
                    <view class="listParticipant1" style="width: 710rpx; height: 30rpx; display: flex;">
                        <view class="time" >{{item.date}}</view>
                        <view style="margin-left: 32%; width: 25%;">{{item.statut}}</view>
                    </view>     
                </block>
            </view>
        </block>
        <block wx:if="{{!result}}">
            <view style="width: 351rpx; height: 49rpx; display: block; box-sizing: border-box; margin-left: 25%; margin-top: 12px">Pas de données à afficher</view>
        </block>
    </Scroll-view>
</view>

<view style="width: 731rpx; height: 163rpx; display: block; box-sizing: border-box; margin-left: 10rpx">
    <view style="position: relative; color: #FF7900; font-size: 36rpx; font-weight: bolder; left: -17rpx; top: 0rpx; width: 710rpx; height: 49rpx; display: block; box-sizing: border-box; margin-left: 22rpx">Bénéficiaire de la cagnotte</view>
    <block wx:for="{{result}}" wx:key="id">
        <block wx:for="{{item.participant}}" wx:for-item="participant" wx:key="id_participant">
            <block wx:if="{{participant.numero_ordre === tour.numero_tour}}">
                <view style="position: relative; font-size: 31rpx; font-weight: bolder; left: 20rpx; top: 39rpx; width: 688rpx; height: 49rpx; display: block; box-sizing: content-box">{{participant.utilisateur.nom}} {{participant.utilisateur.prenoms}}</view>
            </block>
        </block>
    </block>
    <block wx:if="{{!result}}">
        <view style="width: 355rpx; height: 49rpx; display: block; box-sizing: border-box; margin-left: 25%; margin-top: 12px">Pas de données à afficher</view>
    </block>
</view>