<!--index.wxml-->
<nav></nav>

<view class="conteneur">
    <block wx:for="{{result}}" wx:key="id">
        <view style="position: relative; top: 18rpx; text-align: center; font-weight: bolder; ">{{item.nom_tontine}}</view>
    </block>
</view>

<!-- Informations -->
<view style="width: 750rpx; height: 260rpx; display: block; box-sizing: border-box" class="conteneur">
    <block wx:for="{{result}}" wx:key="id">

        <view style="position: relative; width: 345rpx; background: #fff; height: 240rpx; display: block; box-sizing: border-box; left: 12rpx; box-shadow: 0 3rpx 8rpx rgba(255,121,0,1); border-radius: 18rpx;">
            <view style="position: relative; left: 17rpx; top: 26rpx; font-size: 35rpx; font-weight: bold; margin-bottom: 1vh;">Nombre de participant.e.s</view>
            <view style="position: relative; width: 95rpx; background: #ED6C30; height: 95rpx; left: 222rpx; top: 25rpx; display: block; box-sizing: border-box; border-radius: 99rpx; margin-left: -6vh; align-items: center;text-align: center;"> <text style="position: relative; top: -10rpx; font-size: 30rpx; font-weight: bolder; color: #FFFFFFFF;">
                    {{item.nombre_participants}}</text></view>
        </view>

        <view style="position: relative; left: 395rpx; top: -15vh;width: 345rpx; background: #fff; height: 240rpx;display: block; box-sizing: border-box;box-shadow: 0 3rpx 8rpx rgba(255,121,0,1); border-radius: 18rpx;">
            <view style="position: relative; left: 17rpx; top: 26rpx; font-size: 35rpx; font-weight: bold;">Montant de la cagnotte</view>
            <view style="position: relative; left: 1rpx; top: 37%; text-align: center; padding-right: 5px; font-weight: bold;">
                {{item.montant_total}} Fcfa
            </view>
        </view>
    </block>
</view>

<!-- Participants -->
<view style="width: 707rpx; height: 384rpx; margin-left: 18rpx; display: block; box-sizing: border-box" class="conteneur contour">
    <block wx:for="{{result}}" wx:key="id">
        <text style="position: relative; left: 22rpx; top: 0rpx" class="h1">Participants</text>
        <scroll-view scroll-y="true" class="scrollarea" style="width: 710rpx; height: 320rpx; display: block; box-sizing: border-box; background-color: #d9d9d960; border-radius: 18rpx;">
            <view style="position: relative; width: 710rpx; height: auto; left: 0rpx; top: 23rpx; display: block; box-sizing: border-box">
                <view data-index="{{index}}">
                    <block wx:for="{{participantList}}" wx:for-item="participant" wx:for-index="participantIndex" wx:key="id_participant">
                        <view class="listParticipant" style="width: 710rpx; height: 63rpx; display: flex; align-items: center; box-sizing: border-box; border-bottom: 1rpx solid #d9d9d9;">
                            <view class="index-number" style="width: 50rpx; font-size: 28rpx; color: #333; margin-right: 20rpx;">{{participantIndex + 1}}.</view>
                            <view class="nom">{{participant.utilisateur.nom}} {{participant.utilisateur.prenoms}}</view>
                            <view class="montant">{{item.montant_a_cotise}}</view>
                        </view>
                    </block>
                </view>
            </view>
        </scroll-view>
    </block>
</view>




<view wx:if="{{isAdmin}}" style="position: relative; width: 328rpx; height: 80rpx; left: 400rpx; top: 18rpx; display: flex; justify-content: center; align-items: center; box-sizing: border-box; background: rgb(255, 135, 23); color: #fff; border-radius: 18rpx;" bind:tap="openModal">
    <text>Modifier l'ordre</text>
</view>
<!-- Pénalités -->
<view style="width: 750rpx; height: 306rpx; display: block; box-sizing: border-box" class="conteneur">
    <text style="position: relative; left: 22rpx; top: 0rpx" class="h1">Pénalités</text>
    <Scroll-view scroll-y="true" class="scrollarea" style="width: 750rpx; height: 295rpx; display: block; box-sizing: border-box">
        <view style="position: relative; width: 750rpx; background: white; height: 88rpx; left: 0rpx; top: 23rpx; display: block; box-sizing: border-box">
            <block wx:for="{{result}}" wx:key="id">
                <view data-index="{{index}}">
                    <!-- <block wx:for="{{item.participant}}" wx:for-item="participant" wx:key="participant.id_participant"> -->
                    <block wx:for="{{item.participant}}" wx:for-item="participant" wx:key="id_participant">
                        <block wx:if="{{participant.penalite && participant.penalite.length>0}}">
                            <block wx:for="{{participant.penalite}}" wx:for-item="penalite" wx:key="id_penalite">
                                <view class="listParticipant" style="width: 736rpx; height: 64rpx; display: flex; box-sizing: border-box">
                                    <view class="nom">
                                        {{participant.utilisateur.nom}} {{participant.utilisateur.prenoms}}
                                    </view>
                                    <!-- <block wx:if="{{participant.penalite && participant.penalite.length>0}}">
            <block wx:for="{{participant.penalite}}" wx:for-item="penalite" wx:key="penalite.id_penalite"> -->
                                    <view class="montant">
                                        {{penalite.montant_penalite}}
                                    </view>
                                    <!-- </block>
          </block> -->
                                </view>
                            </block>
                        </block>
                    </block>
                </view>
            </block>
        </view>
    </Scroll-view>
</view>

<!-- Modal de modification d'ordre -->
<!-- <view class="modal-overlay" wx:if="{{showModal}}" bindtap="hideModal">
  <view class="modal-container" catchtap="stopPropagation">
    <text style="position: relative; left: 22rpx; top: 0rpx" class="h1">Modifier l'ordre de récupération</text>
    <view style="position: relative; width: 100%; background: white; height: 100px; left: 0rpx; top: 24rpx">
      <block wx:for="{{result}}" wx:key="id">
        <view data-index="{{index}}">
          <block wx:for="{{item.participant}}" wx:for-item="participant" wx:key="id_participant">
            <view class="listParticipant" style="width: 90%; height: 64rpx; display: flex; box-sizing: border-box">
              <view class="nom">
                {{participant.utilisateur.nom}} {{participant.utilisateur.prenoms}}
              </view>
              <view class="montant">{{item.numero_ordre}}</view>
            </view>
          </block>
        </view>
      </block>
    </view> -->

<!-- Modal pour l'intégration avec liste scrollable et réorganisation -->
<view wx:if="{{showModal}}" class="modal-overlay" bindtap="closeModal">
    <view class="modal-container1" catchtap="preventClose">
        <!-- En-tête de la modal -->
        <view class="modal-header1">
            <view class="modal-title-container1">
                <text class="modal-title1">Modifier l'ordre de la tontine</text>
            </view>
            <view class="close-button" bindtap="closeModal">
                <image src="../../images/mingcute_close-fill.png" class="close-icon" />
            </view>
        </view>

        <!-- Corps de la modal avec liste scrollable -->
        <!-- <scroll-view scroll-y="true" class="modal-scroll1" enhanced="true"> -->
        <view class="modal-body1">
            <!-- Conteneur pour la liste des membres -->
            <scroll-view scroll-y="true" class="modal-scroll1" enhanced="true">
                <view class="user-list modal-background">
                    <view wx:for="{{participantList}}" wx:key="id" data-index="{{index}}" bindtouchstart="onTouchStart" bindtouchmove="onTouchMove" bindtouchend="onTouchEnd" class="user-item {{currentDraggingIndex === index ? 'dragging' : ''}}">
                        <text class="member-text">{{index+1}}. {{item.utilisateur.nom}} {{item.utilisateur.prenoms}}</text>
                    </view>
                </view>

            </scroll-view>

            <!-- Bouton de validation -->
            <view class="modal-footer">
                <!-- <view class="confirm-button" bindtap="validateOrder">
                            Valider
                        </view>-->
            </view>
        </view>
        <!-- </scroll-view> -->
    </view>
</view>