<!--index.wxml-->
<nav></nav>

<view class="conteneur">
    <block wx:for="{{result}}" wx:key="id">
        <view style="position: relative; top: 15rpx; text-align: center; margin-bottom: 20rpx; font-weight: bolder;">{{item.nom_tontine}}</view>
    </block>
</view>

<!-- Informations -->
<view>
    <block wx:for="{{result}}" wx:key="id">
        <view class="card">
            <view class="card-header">
                <view class="card-title">Nombre de participants : {{item.nombre_participants}} </view>
               <!-- <view class="">
                    {{item.nombre_participants}}
                </view> -->
            </view>
            <view>
                <view class="card-body">Montant de la cagnotte {{item.montant_total}} Fcfa </view>
            </view>
        </view>
    </block>
</view>


<!-- Participants -->
<view class="conteneur">
    <block wx:for="{{result}}" wx:key="id">
        <text class="title">Participants à jour</text>
        <scroll-view scroll-y class="scrollarea">
            <view>
                <view data-index="{{index}}">
                    <block wx:for="{{participantList}}" wx:for-item="participant" wx:for-index="participantIndex" wx:key="id_participant">
                        <view class="listParticipant">
                            <view class="left">
                                <view class="index-number">{{participantIndex + 1}}.</view>
                                <view class="nom">{{participant.utilisateur.nom}} {{participant.utilisateur.prenoms}}</view>
                            </view>
                            <view class="montant">{{item.montant_a_cotise}}</view>
                        </view>
                    </block>
                </view>
            </view>
        </scroll-view>
    </block>
</view>

<view style="display: flex; justify-content: flex-end; padding: 20rpx;">
    <view wx:if="{{isAdmin}}" style="width: 250rpx; height: 80rpx;display: flex; justify-content: center; align-items: center;box-sizing: border-box; background: #F16E00; color:#fff; border-radius: 10px;" bind:tap="openModal">
        Modifier l'ordre
    </view>
</view>

<!-- Pénalités -->
<view class="conteneur">
    <Scroll-view scroll-y="true" class="scrollarea">
        <view>
            <block wx:for="{{result}}" wx:key="id">
                <view data-index="{{index}}">
                    <!-- <block wx:for="{{item.participant}}" wx:for-item="participant" wx:key="participant.id_participant"> -->
                    <block wx:for="{{item.participant}}" wx:for-item="participant" wx:key="id_participant">
                        <block wx:if="{{participant.penalite && participant.penalite.length>0}}">
                            <block wx:for="{{participant.penalite}}" wx:for-item="penalite" wx:key="id_penalite">
                                <text class="title">Pénalités</text>
                                <view class="listParticipant" style="width: 736rpx; height: 64rpx; display: flex; box-sizing: border-box">
                                    <view class="nom">
                                        {{participant.utilisateur.nom}} {{participant.utilisateur.prenoms}}
                                    </view>
                                    <!-- <block wx:if="{{participant.penalite && participant.penalite.length>0}}">
            <block wx:for="{{participant.penalite}}" wx:for-item="penalite" wx:key="penalite.id_penalite"> -->
                                    <view class="montant">
                                        {{penalite.montant_penalite}}
                                    </view>
                                    <!-- </block>
          </block> -->
                                </view>
                            </block>
                        </block>
                    </block>
                </view>
            </block>
        </view>
    </Scroll-view>
</view>

<!-- Modal de modification d'ordre -->
<!-- <view class="modal-overlay" wx:if="{{showModal}}" bindtap="hideModal">
  <view class="modal-container" catchtap="stopPropagation">
    <text style="position: relative; left: 22rpx; top: 0rpx" class="h1">Modifier l'ordre de récupération</text>
    <view style="position: relative; width: 100%; background: white; height: 100px; left: 0rpx; top: 24rpx">
      <block wx:for="{{result}}" wx:key="id">
        <view data-index="{{index}}">
          <block wx:for="{{item.participant}}" wx:for-item="participant" wx:key="id_participant">
            <view class="listParticipant" style="width: 90%; height: 64rpx; display: flex; box-sizing: border-box">
              <view class="nom">
                {{participant.utilisateur.nom}} {{participant.utilisateur.prenoms}}
              </view>
              <view class="montant">{{item.numero_ordre}}</view>
            </view>
          </block>
        </view>
      </block>
    </view> -->

<!-- Modal pour l'intégration avec liste scrollable et réorganisation -->
<view wx:if="{{showModal}}" class="modal-overlay" bindtap="closeModal">
    <view class="modal-container1" catchtap="preventClose">
        <!-- En-tête de la modal -->
        <view class="modal-header1">
            <view class="modal-title-container1">
                <text class="modal-title1">Modifier l'ordre de la tontine</text>
            </view>
            <view class="close-button" bindtap="closeModal">
                <image src="../../images/mingcute_close-fill.png" class="close-icon" />
            </view>
        </view>

        <!-- Corps de la modal avec liste scrollable -->
        <!-- <scroll-view scroll-y="true" class="modal-scroll1" enhanced="true"> -->
        <view class="modal-body1">
            <!-- Conteneur pour la liste des membres -->
            <scroll-view scroll-y="true" class="modal-scroll1" enhanced="true">
                <view class="user-list modal-background">
                    <view wx:for="{{participantList}}" wx:key="id" data-index="{{index}}" bindtouchstart="onTouchStart" bindtouchmove="onTouchMove" bindtouchend="onTouchEnd" class="user-item {{currentDraggingIndex === index ? 'dragging' : ''}}">
                        <text class="member-text">{{index+1}}. {{item.utilisateur.nom}} {{item.utilisateur.prenoms}}</text>
                    </view>
                </view>

            </scroll-view>

            <!-- Bouton de validation -->
            <view class="modal-footer">
                <!-- <view class="confirm-button" bindtap="validateOrder">
                            Valider
                        </view>-->
            </view>
        </view>
        <!-- </scroll-view> -->
    </view>
</view>